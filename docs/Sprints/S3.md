# **Product Backlog – BibliotecaDigital (Plan para Sprint 3)**

## Historias Épicas (Actualizadas) 

* **E1 - Gestión de Biblioteca y Usuarios:** Administración y consulta de los recursos principales de la biblioteca.
* **E2 - Préstamos Digitales:** Gestión del ciclo de vida de los préstamos de materiales digitales.
* **E3 - Soporte Académico y Calidad:** Aseguramiento de la calidad del software y funcionalidades de valor añadido.
* **E4 - Persistencia de Datos:** Gestión de la capa de almacenamiento de datos.
    * *Incluye: HU-11, HU-12, HU-18*
* **E5 - Interfaz Gráfica de Administración (CRUDs):** Creación de las interfaces visuales para la gestión del sistema.
    * *Incluye: HU-13, HU-14, HU-15, HU-16, HU-19*
* **E6 - Arquitectura y Refactorización (Nueva Épica):** Mejoras estructurales del código para aumentar la mantenibilidad, escalabilidad y seguir las mejores prácticas de diseño.
    * *Incluye: HU-17*

***
## Historias de Usuario para el Sprint 3 

### **HU-17 – Refactorización a Repositorios por Entidad**
* **Historia de Usuario:** Como desarrollador, quiero refactorizar la "Clase Dios" `JpaBibliotecaRepository` en repositorios específicos por entidad (`AutorRepository`, `UsuarioRepository`, etc.) para mejorar la cohesión y seguir el Principio de Responsabilidad Única.
* **Criterios de Aceptación:**
    * Debe existir una interfaz y una implementación JPA para cada entidad principal (Autor, Usuario, Material, Préstamo).
    * La clase `JpaBibliotecaRepository` y la interfaz `BibliotecaService` deben ser eliminadas o marcadas como obsoletas.
    * Los controladores de la GUI deben ser actualizados para inyectar y utilizar los nuevos repositorios específicos que necesiten.
    * La aplicación debe seguir funcionando como antes, pero con la nueva estructura de repositorios.
* **Tareas Técnicas:**
    1.  Crear las nuevas interfaces: `AutorRepository`, `UsuarioRepository`, `MaterialRepository`, `PrestamoRepository`.
    2.  Crear las implementaciones JPA: `JpaAutorRepository`, `JpaUsuarioRepository`, etc.
    3.  Mover la lógica correspondiente de `JpaBibliotecaRepository` a cada nueva clase.
    4.  Actualizar los constructores de los controladores (`GestionAutoresController`, etc.) para que reciban los repositorios específicos.

---
### **HU-18 – Migración de la Base de Datos a MySQL**
* **Historia de Usuario:** Como desarrollador, quiero migrar la capa de persistencia de SQLite a MySQL para preparar la aplicación para un entorno de producción multiusuario y más robusto.
* **Criterios de Aceptación:**
    * El `pom.xml` debe incluir la dependencia del conector de MySQL (`mysql-connector-j`) y eliminar la de SQLite.
    * El archivo `persistence.xml` debe ser actualizado con la URL de conexión, el driver y el dialecto de MySQL.
    * La aplicación debe arrancar correctamente y crear/conectar con una base de datos MySQL local.
    * Todas las funcionalidades CRUD y de préstamos deben operar sin cambios sobre la nueva base de datos.
* **Tareas Técnicas:**
    * Añadir la dependencia de `mysql-connector-j` al `pom.xml`.
    * Eliminar la dependencia de `sqlite-jdbc`.
    * Modificar las propiedades `jakarta.persistence.jdbc.url`, `...driver` y `hibernate.dialect` en `persistence.xml`.
    * Crear una base de datos local en MySQL (ej. `biblioteca_db`) para que la aplicación se conecte.

---
### **HU-19 – Creación de un Menú Principal de Navegación**
* **Historia de Usuario:** Como administrador, quiero un menú principal o dashboard al iniciar la aplicación, desde donde pueda acceder a las diferentes ventanas de gestión (CRUDs).
* **Criterios de Aceptación:**
    * Al ejecutar la aplicación, se debe mostrar una única ventana principal (menú).
    * Esta ventana debe contener botones o elementos de menú para "Gestionar Materiales", "Gestionar Autores", "Gestionar Usuarios", etc.
    * Hacer clic en un botón debe abrir la ventana CRUD correspondiente.
    * Cerrar una ventana CRUD no debe cerrar la aplicación entera, sino devolver al usuario al menú principal.
* **Tareas Técnicas:**
    * Crear una nueva vista `MenuView` (JFrame) con los botones de navegación.
    * Crear un `MenuController` que escuche los eventos de los botones.
    * La acción de cada botón en el `MenuController` debe instanciar y mostrar la vista y el controlador del CRUD correspondiente.
    * Modificar la clase `BibliotecaDigital.java` para que su método `main` solo lance el `MenuView` y su `MenuController`.
    * Ajustar el `defaultCloseOperation` de las ventanas CRUD a `DISPOSE_ON_CLOSE` en lugar de `EXIT_ON_CLOSE`.

---
### **HU-20 – Lógica de Préstamos para Materiales Digitales**
* **Historia de Usuario:** Como desarrollador, quiero modificar la lógica de negocio para que los materiales digitales puedan ser prestados un número ilimitado de veces simultáneamente.
* **Criterios de Aceptación:**
    * El campo `disponible` debe ser eliminado de la clase `MaterialBiblioteca` y de la base de datos.
    * El método `crearPrestamo` ya no debe verificar si un material está disponible antes de realizar un préstamo.
    * El método `registrarDevolucion` ya no debe cambiar el estado de un material. Su única función es marcar el `Prestamo` como completado.
* **Tareas Técnicas:**
    * Eliminar el atributo `disponible` y sus métodos getter/setter de `MaterialBiblioteca.java`.
    * Modificar la lógica en la implementación del `PrestamoRepository` para eliminar las validaciones de disponibilidad.
    * Ajustar las vistas o controladores que puedan estar mostrando el estado "Disponible/No Disponible" para que ya no lo hagan.

***
## **Tabla Resumen Backlog para Sprint 3**

| Título | Descripción | Etiqueta | Prioridad |
| :--- | :--- | :--- | :--- |
| **HU-17 – Refactorización de Repositorios** | "Como dev, quiero separar la 'Clase Dios' JpaBibliotecaRepository." | Sprint 3 | **Crítica** |
| **HU-18 – Migración a MySQL** | "Como dev, quiero que la app use MySQL en lugar de SQLite." | Sprint 3 | **Alta** |
| **HU-19 – Menú Principal de Navegación** | "Como admin, quiero un menú central para acceder a los CRUDs." | Sprint 3 | **Alta** |
| **HU-20 – Lógica de Préstamos Digitales** | "Como dev, quiero que los materiales se puedan prestar N veces." | Sprint 3 | Media |

---
## **Orden de Implementación Sugerido para Sprint 3**

El orden en este sprint es flexible, pero esta secuencia es la más lógica para minimizar riesgos.

1.  **Primero (HU-17 - Refactorización):** Es la tarea más importante. Refactorizar a repositorios específicos **antes** de hacer otros cambios grandes limpiará tu código y hará que los siguientes pasos sean mucho más sencillos y seguros.
2.  **Segundo (HU-20 - Lógica de Préstamos):** Este es un cambio en el modelo de dominio. Es bueno hacerlo después de la refactorización para implementarlo en el nuevo y limpio `PrestamoRepository`.
3.  **Tercero (HU-18 - Migración a MySQL):** Una vez que tu lógica de repositorios es sólida y correcta, cambiar la base de datos subyacente es un paso relativamente simple y de bajo riesgo.
4.  **Cuarto (HU-19 - Menú Principal):** Esta es la capa final de "pulido" de la experiencia de usuario. Se construye al final, una vez que todas las ventanas que debe llamar ya existen y funcionan con la nueva arquitectura y base de datos.